<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>numba wasm vs pyodide</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'SF Mono', Menlo, monospace; font-size: 13px; color: #111; padding: 48px 24px; max-width: 900px; margin: 0 auto; }
  h1 { font-size: 14px; font-weight: 500; color: #999; margin-bottom: 8px; }
  .subtitle { font-size: 12px; color: #666; margin-bottom: 32px; }
  .examples { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
  .ex { background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; padding: 6px 12px; cursor: pointer; font-size: 12px; }
  .ex:hover { border-color: #999; }
  .ex.active { background: #0066cc; color: #fff; border-color: #0066cc; }
  .code { background: #f7f7f7; border: 1px solid #e5e5e5; border-radius: 4px; padding: 12px; font-size: 12px; line-height: 1.6; margin-bottom: 16px; white-space: pre; overflow-x: auto; }
  .row { display: flex; gap: 24px; margin-bottom: 24px; }
  .col { flex: 1; }
  .col h2 { font-size: 12px; font-weight: 500; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
  button { background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 8px 20px; font-family: inherit; font-size: 12px; cursor: pointer; }
  button:hover { border-color: #999; }
  button:disabled { opacity: 0.5; cursor: wait; }
  .output { background: #fafafa; border: 1px solid #eee; border-radius: 4px; padding: 12px; min-height: 80px; font-size: 12px; line-height: 1.6; }
  .ok { color: #16a34a; }
  .err { color: #dc2626; }
  .dim { color: #999; }
  .speedup { font-size: 18px; font-weight: 600; margin-top: 16px; }
  .speedup.fast { color: #16a34a; }
  .note { font-size: 11px; color: #999; margin-top: 32px; line-height: 1.6; border-top: 1px solid #eee; padding-top: 16px; }
</style>
</head>
<body>

<h1>numba WASM vs Pyodide</h1>
<p class="subtitle">Compare pre-compiled WebAssembly against interpreted Python in the browser</p>

<div class="examples">
  <div class="ex active" onclick="select('fib')">fibonacci</div>
  <div class="ex" onclick="select('sum_n')">sum loop</div>
  <div class="ex" onclick="select('prime')">prime check</div>
</div>

<div id="code" class="code"></div>

<div class="row">
  <div class="col">
    <h2>Pyodide (Python interpreter)</h2>
    <button id="btnPy" onclick="runPyodide()" disabled>loading pyodide...</button>
    <div id="outPy" class="output"></div>
  </div>
  <div class="col">
    <h2>numba WASM (compiled)</h2>
    <button id="btnWasm" onclick="runWasm()">run wasm</button>
    <div id="outWasm" class="output"></div>
  </div>
</div>

<div id="comparison"></div>

<div class="note">
  <strong>How it works:</strong><br>
  • Pyodide runs CPython compiled to WebAssembly — it interprets your Python code<br>
  • numba compiles Python to native WebAssembly ahead-of-time — no interpretation overhead<br>
  • Both run entirely in your browser, no server required for execution
</div>

<script src="https://cdn.jsdelivr.net/pyodide/v0.27.4/full/pyodide.js"></script>
<script>
const examples = {
  fib: {
    code: `def fib(n):
    if n <= 1:
        return n
    a, b = 0, 1
    for _ in range(n - 1):
        a, b = b, a + b
    return b`,
    func: 'fib',
    arg: 35,
    wasm: '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',
  },
  sum_n: {
    code: `def sum_n(n):
    total = 0
    for i in range(n):
        total += i
    return total`,
    func: 'sum_n',
    arg: 10000000,
    wasm: 'AGFzbQEAAAABCwJgAABgA39/fgF/AwMCAAEFAwEAAgY/Cn8BQZCJBAt/AEGACAt/AEGECQt/AEGQCQt/AEGQiQQLfwBBgAgLfwBBkIkEC38AQYCACAt/AEEAC38AQQELB/EBDAZtZW1vcnkCABFfX3dhc21fY2FsbF9jdG9ycwAATV9aTjEzXzNjZHluYW1pY18zZTVzdW1fbkIydjlCNDRjOHRKVEFlR0lzSjF0bUNQQV8yZjJQRmhXMm9HUUJFVWFOT0xDRUpnQV8zZEV4AAEMX19kc29faGFuZGxlAwEKX19kYXRhX2VuZAMCC19fc3RhY2tfbG93AwMMX19zdGFja19oaWdoAwQNX19nbG9iYWxfYmFzZQMFC19faGVhcF9iYXNlAwYKX19oZWFwX2VuZAMHDV9fbWVtb3J5X2Jhc2UDCAxfX3RhYmxlX2Jhc2UDCQqwBgICAAuqBgMBfwF+AX8jgICAgABB8AFrIgMkgICAgAAgA0IANwPQASADQgA3A+gBIANCADcD2AEgA0IANwPgASADQgA3A7gBIANCADcDwAEgA0IANwPIASADQQA2ApgBIANCADcDoAEgA0IANwOoASADQQA2ArABIANCADcDkAEgA0IANwOIASADQgA3A4ABIANBADYCYCADQgA3A2ggA0IANwNwIANBADYCeCADQgA3A8ABIANCADcDyAEgA0EAOgBYIANCADcDUCADQQA2AkggA0IANwNAIANCADcDOCADQQA2AjAgA0EAOgAoIANCADcDICADQQA6ABggA0IANwMQIANCADcDCCADQgA3A+gBIANCADcD0AEgAyACNwPYASADQgE3A+ABIANCADcDuAEgAyACNwPAASADQgE3A8gBIANCADcDuAEgA0IANwOQASADIAMpA8ABIgQ3A6ABIAMgAykDyAEiAjcDqAEgAyADQZABajYCmAEgAyADQYgBajYCsAECQCACUA0AAkACQCAEQgBVIAJCAFVzRQ0AIAMoArABQgA3AwAMAQsgAygCsAEgBCACfyAEIAKBIgJCACACfSAEQgBVG0IAVa18NwMACyADIAMoApgBNgJgIAMgAykDoAE3A2ggAyADKQOoATcDcCADIAMoArABNgJ4A0AgAyADKAJgNgIwIAMgAykDaDcDOCADIAMpA3A3A0AgAyADKAJ4IgE2AkggA0IANwNQIAMgASkDACIEQgBVIgU6AFgCQCAFRQ0AIAMoAjAiBSkDACECIAEgBEJ/fDcDACAFIAIgAykDQHw3AwAgAyACNwNQCyADIAMpA1AiAjcDICADIAMtAFgiAToAKCADIAI3AxAgAyABOgAYIAMgAjcDCAJAIAFFDQAgAykDCCECIANCADcDCCADIAIgAykD6AF8NwPoAQwBCwsgACADKQPoATcDACADQQA2AmAgA0IANwMIIANCADcDaCADQgA3A3AgA0EANgJ4IANCADcD6AEgA0HwAWokgICAgABBAA8LIAFB8IiAgAA2AgAgA0IANwOAASADQfABaiSAgICAAEEBCwuMAQEAQYAIC4QBgASVQQAAAAAAAACMCGJ1aWx0aW5zlIwKVmFsdWVFcnJvcpSTlIwecmFuZ2UoKSBhcmcgMyBtdXN0IG5vdCBiZSB6ZXJvlIWUToeULgAAAADKjvs6ctYU/ocgMszjrDJgB6MHJwAAAAAAAAAAAAAAAAAEAABMAAAAUAQAAAAAAAAAAAAAAKQBBG5hbWUADAtvdXRwdXQud2FzbQFvAgARX193YXNtX2NhbGxfY3RvcnMBWV8zY2R5bmFtaWNfM2U6OnN1bV9uW2FiaTp2OV1bYWJpOmM4dEpUQWVHSXNKMXRtQ1BBXzJmMlBGaFcyb0dRQkVVYU5PTENFSmdBXzNkXShsb25nIGxvbmcpBxIBAA9fX3N0YWNrX3BvaW50ZXIJCgEABy5yb2RhdGEAlAEPdGFyZ2V0X2ZlYXR1cmVzCCsLYnVsay1tZW1vcnkrD2J1bGstbWVtb3J5LW9wdCsWY2FsbC1pbmRpcmVjdC1vdmVybG9uZysKbXVsdGl2YWx1ZSsPbXV0YWJsZS1nbG9iYWxzKxNub250cmFwcGluZy1mcHRvaW50Kw9yZWZlcmVuY2UtdHlwZXMrCHNpZ24tZXh0',
  },
  prime: {
    code: `def is_prime(n):
    if n < 2:
        return 0
    if n == 2:
        return 1
    if n % 2 == 0:
        return 0
    i = 3
    while i * i <= n:
        if n % i == 0:
            return 0
        i += 2
    return 1`,
    func: 'is_prime',
    arg: 999999937,
    wasm: 'AGFzbQEAAAABCwJgAABgA39/fgF/AwMCAAEFAwEAAgY/Cn8BQYCIBAt/AEGACAt/AEGACAt/AEGACAt/AEGAiAQLfwBBgAgLfwBBgIgEC38AQYCACAt/AEEAC38AQQELB/UBDAZtZW1vcnkCABFfX3dhc21fY2FsbF9jdG9ycwAAUV9aTjEzXzNjZHluYW1pY18zZThpc19wcmltZUIzdjEwQjQ0Yzh0SlRBZUdJc0oxdG1DUEFfMmYyUEZoVzJvR1FCRVVhTk9MQ0VKZ0FfM2RFeAABDF9fZHNvX2hhbmRsZQMBCl9fZGF0YV9lbmQDAgtfX3N0YWNrX2xvdwMDDF9fc3RhY2tfaGlnaAMEDV9fZ2xvYmFsX2Jhc2UDBQtfX2hlYXBfYmFzZQMGCl9faGVhcF9lbmQDBw1fX21lbW9yeV9iYXNlAwgMX190YWJsZV9iYXNlAwkK0gQCAgALzAQCAX8CfiOAgICAAEHQAGsiA0IANwNAIANCADcDOCADQgA3AzAgA0IANwMoIANCADcDICADQgA3AxggA0IANwMQIANCADcDCCADQgA3AwAgAyACNwNIAkACQAJAAkACQCACQgFXDQAgAykDSEICUQ0BAkBBAEUNACADQgI3AzggA0ICNwNADAULIAMpA0ghAiADQgA3AyggA0IANwMwQQENAgwDCyAAQgA3AwAgA0IANwNIQQAPCyAAQgE3AwAgA0IANwNIQQAPCwJAIAIgAkICfyIEQgGGfSICUA0AIAJCAoVCAFkNACADIAJCAnw3AyggAyAEQn98NwMwDAELIAMgAjcDKCADIAQ3AzALIAMgAykDMDcDQCADIAMpAyg3AzgLAkAgAykDOFANACADQgM3AyADQAJAAkACQCADKQMgIgIgAn4gAykDSFUNACADKQMgIgJQRQ0BIAMgAjcDECADIAI3AxgMAgsgAEIBNwMAIANCADcDICADQgA3A0hBAA8LIAMpA0ghBCADQgA3AwAgA0IANwMIAkAgBEKAgICAgICAgIB/UiACQn9SckUNACAEIAJ/IQUCQCAEIAKBIgRQDQAgAiAEhUIAWQ0AIAMgBCACfDcDACADIAVCf3w3AwgMAQsgAyAENwMAIAMgBTcDCAsgAyADKQMINwMYIAMgAykDADcDEAsCQCADKQMQUA0AIAMgAykDIEICfDcDIAwBCwsgAEIANwMAIANCADcDICADQgA3A0hBAA8LIABCADcDACADQgA3A0hBAAsAnAEEbmFtZQAMC291dHB1dC53YXNtAXMCABFfX3dhc21fY2FsbF9jdG9ycwFdXzNjZHluYW1pY18zZTo6aXNfcHJpbWVbYWJpOnYxMF1bYWJpOmM4dEpUQWVHSXNKMXRtQ1BBXzJmMlBGaFcyb0dRQkVVYU5PTENFSmdBXzNkXShsb25nIGxvbmcpBxIBAA9fX3N0YWNrX3BvaW50ZXIAlAEPdGFyZ2V0X2ZlYXR1cmVzCCsLYnVsay1tZW1vcnkrD2J1bGstbWVtb3J5LW9wdCsWY2FsbC1pbmRpcmVjdC1vdmVybG9uZysKbXVsdGl2YWx1ZSsPbXV0YWJsZS1nbG9iYWxzKxNub250cmFwcGluZy1mcHRvaW50Kw9yZWZlcmVuY2UtdHlwZXMrCHNpZ24tZXh0',
  },
};

let current = 'fib';
let pyodide = null;
let pyTimes = {};
let wasmTimes = {};

function select(name) {
  current = name;
  document.querySelectorAll('.ex').forEach(e => {
    e.classList.remove('active');
    if (e.textContent.toLowerCase().includes(name.replace('_', ' ').split(' ')[0])) {
      e.classList.add('active');
    }
  });
  document.getElementById('code').textContent = examples[name].code;
  document.getElementById('outPy').innerHTML = '';
  document.getElementById('outWasm').innerHTML = '';
  document.getElementById('comparison').innerHTML = '';
}

async function initPyodide() {
  document.getElementById('btnPy').textContent = 'loading pyodide...';
  pyodide = await loadPyodide();
  document.getElementById('btnPy').textContent = 'run python';
  document.getElementById('btnPy').disabled = false;
}

async function runPyodide() {
  const ex = examples[current];
  const btn = document.getElementById('btnPy');
  const out = document.getElementById('outPy');

  btn.disabled = true;
  out.innerHTML = '<span class="dim">running python...</span>';

  try {
    pyodide.runPython(ex.code);
    const iterations = current === 'sum_n' ? 1 : 10;
    const code = `
import time
times = []
for _ in range(${iterations}):
    t0 = time.perf_counter()
    result = ${ex.func}(${ex.arg})
    t1 = time.perf_counter()
    times.append(t1 - t0)
avg_time = sum(times) / len(times)
(result, avg_time * 1000)
`;
    const [result, ms] = pyodide.runPython(code).toJs();
    pyTimes[current] = ms;
    out.innerHTML = `<span class="ok">${ex.func}(${ex.arg}) = ${result}</span>\n<span class="dim">${ms.toFixed(4)} ms</span>`;
    updateComparison();
  } catch (e) {
    out.innerHTML = `<span class="err">${e.message}</span>`;
  } finally {
    btn.disabled = false;
  }
}

async function runWasm() {
  const ex = examples[current];
  const btn = document.getElementById('btnWasm');
  const out = document.getElementById('outWasm');

  btn.disabled = true;
  out.innerHTML = '<span class="dim">loading wasm...</span>';

  try {
    const bytes = Uint8Array.from(atob(ex.wasm), c => c.charCodeAt(0));
    const { instance } = await WebAssembly.instantiate(bytes);

    // Find the function export (look for mangled name containing our function)
    const exports = Object.keys(instance.exports);
    const fnName = exports.find(n => n.toLowerCase().includes(ex.func.replace('_',''))) || ex.func;
    const fn = instance.exports[fnName];

    if (!fn) {
      out.innerHTML = `<span class="err">function not found</span>\n<span class="dim">exports: ${exports.slice(0,5).join(', ')}...</span>`;
      return;
    }

    const memory = instance.exports.memory;
    const RETPTR = 0;
    const EXCINFO = 16;

    // Warm up
    fn(RETPTR, EXCINFO, BigInt(ex.arg));

    // Time the execution
    const iterations = 100;
    const t0 = performance.now();
    for (let i = 0; i < iterations; i++) {
      fn(RETPTR, EXCINFO, BigInt(ex.arg));
    }
    const t1 = performance.now();
    const ms = (t1 - t0) / iterations;

    // Read result
    const view = new DataView(memory.buffer);
    const lo = view.getUint32(RETPTR, true);
    const hi = view.getInt32(RETPTR + 4, true);
    const result = lo + hi * 0x100000000;

    wasmTimes[current] = ms;
    out.innerHTML = `<span class="ok">${ex.func}(${ex.arg}) = ${result}</span>\n<span class="dim">${ms.toFixed(4)} ms</span>`;
    updateComparison();
  } catch (e) {
    out.innerHTML = `<span class="err">${e.message}</span>`;
  } finally {
    btn.disabled = false;
  }
}

function updateComparison() {
  const comp = document.getElementById('comparison');
  if (pyTimes[current] && wasmTimes[current]) {
    const speedup = pyTimes[current] / wasmTimes[current];
    comp.innerHTML = `<div class="speedup fast">numba WASM is ${speedup.toFixed(1)}x faster</div>`;
  }
}

select('fib');
initPyodide();
</script>
</body>
</html>
